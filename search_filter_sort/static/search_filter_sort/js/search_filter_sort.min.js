var can_do_enter_button_form_submissions=true;var search_bys=[];var filter_bys={};var original_filter_bys={};var range_filters={};var sort_bys=[];var paginate_by=[];var page_number=1;function initialize_search_filter_sort(){paginate_by=[default_pagination];var page_number_text=$("#page_number_text");var select_all_pages_checkbox=$("#select_all_pages_checkbox");var object_list_checkbox=$(".object-list-checkbox");var action_btns=$(".sfs-action-btn");var select_all_on_page=$("#select_all_objects_checkbox");$("#paginate_by_select").change(function(){paginate_by=[$(this).val()];goto_new_url(true,true,true)});if(page_number_text.val()){page_num_input_form_size(page_number_text)}page_num_input_form_size(page_number_text);page_number_text.on('input',function(){page_num_input_form_size(page_number_text)});$(window).keydown(function(event){var key_code=event.which||event.key;if(key_code===13&&$("#search_text").is(":focus")){search()}if(key_code===13&&page_number_text.is(":focus")){goto_page(page_number_text.val())}});select_all_pages_checkbox.change(function(){var disable_state=$(this).prop("checked");$("#select_all_objects_checkbox").attr("disabled",disable_state);object_list_checkbox.each(function(){$(this).prop('checked',false);$(this).attr("disabled",disable_state)})});set_filter_mousedown_functions();set_filter_keydown_functions();get_url_parameters(search_bys,"search_by");get_filter_by_parameters();get_url_parameters(sort_bys,"sort_by");get_url_parameters(paginate_by,"paginate_by");set_filters();set_sort_symbols();set_pagination();fix_range_filters();if(search_bys.length>0){$("#clear_search_button").prop("disabled",false)}set_filter_button_states();if(sort_bys.length>0){$("#clear_sorts_button").prop("disabled",false)}select_all_on_page.change(function(){if(object_list_checkbox.length>0){action_btns.attr("disabled",!this.checked)}});select_all_pages_checkbox.change(function(){if(object_list_checkbox.length>0){action_btns.attr("disabled",!this.checked)}});object_list_checkbox.change(function(){if(select_all_on_page.is(":not(:checked)")){if(!$("table").find($(".object-list-checkbox:checked")).length>0){action_btns.attr("disabled","disabled")}else{action_btns.removeAttr("disabled")}}})}function page_num_input_form_size(page_number_text){if(page_number_text.val()){var page_number_text_size=page_number_text.val().length*10+25;var page_number_width=page_number_text_size+"px";page_number_text.css({width:page_number_width,"max-width":"125px"})}}function set_filter_mousedown_functions(){var split_filters;var filter_name;var filter_quantity_span;var select=null;$("select.multi-select.sfs-filter").mousedown(function(e){e.preventDefault();select=this;$(select).focus();}).mousemove(function(e){e.preventDefault()});var options=$("select.multi-select.sfs-filter option");options.click(function(){var scroll=select.scrollTop;filter_name=$(this).parent().attr("name").split("_filter")[0];filter_quantity_span=$("#"+filter_name+"_quantity_span");if($(this).prop("selected")){$(this).prop("selected",false);split_filters=filter_bys[filter_name].split(",");split_filters.splice(split_filters.indexOf($(this).val()),1);filter_bys[filter_name]=split_filters.join(",");if(filter_bys[filter_name].length===0){filter_quantity_span.text("");delete filter_bys[filter_name]}else{filter_quantity_span.text("("+filter_bys[filter_name].split(",").length+")")}}else{$(this).prop("selected",true);if(!filter_bys[filter_name]){filter_bys[filter_name]=$(this).val()}else{filter_bys[filter_name]+=","+$(this).val()}filter_quantity_span.text("("+filter_bys[filter_name].split(",").length+")")}setTimeout(function(){select.scrollTop=scroll},0);set_filter_button_states();return false})}function set_filter_keydown_functions(){var input_length;var filter_name;$("input.range-filter").on("input",function(){input_length=$(this).val().length;filter_name=$(this).attr("name").split("-filter")[0];if(input_length>0){range_filters[filter_name]=$(this).val();}else if(range_filters[filter_name]&&input_length===0){delete range_filters[filter_name]}set_filter_button_states()})}function get_url_parameters(array,string){var parameters=decodeURIComponent(window.location.href).split("?");var KEY=0;var VALUE=1;var i;var parameter;if(parameters.length===2){parameters=parameters[1].split("&")}else{return}for(i=0;i<parameters.length;i+=1){parameter=parameters[i].split("=");if(parameter[KEY]===string){array.push(parameter[VALUE])}}}function get_filter_by_parameters(){var parameters=decodeURIComponent(window.location.href).split("?");var KEY=0;var VALUE=1;var i;var filter_names=[];var filter_values=[];var parameter;var filter_name;if(parameters.length===2){parameters=parameters[1].split("&")}else{return}for(i=0;i<parameters.length;i+=1){parameter=parameters[i].split("=");if(parameter[KEY]==="filter_name"){filter_names.push(parameter[VALUE])}}for(i=0;i<parameters.length;i+=1){parameter=parameters[i].split("=");if(parameter[KEY]==="filter_value"){filter_values.push(parameter[VALUE])}}for(i=0;i<filter_names.length;i+=1){filter_bys[filter_names[i]]=filter_values[i]}original_filter_bys=$.extend(true,{},filter_bys)}function set_filters(){var i;var filter_name;var filter_quantity_span;var hidden_filters=$.extend({},filter_bys);if(typeof filter_names!==typeof undefined){for(i=0;i<filter_names.length;i+=1){filter_name=filter_names[i];filter_quantity_span=$("#"+filter_name+"_quantity_span");if(filter_bys[filter_name]){$("#"+filter_name+"_filter").val(filter_bys[filter_name].split(","));filter_quantity_span.text("("+filter_bys[filter_name].split(",").length+")");delete hidden_filters[filter_name]}}}if(Object.keys(hidden_filters).length>0){$("#hidden_filters_message_div").css("display","")}}function set_sort_symbols(){var i;var sort_by_split;var sort_text;for(i=0;i<sort_bys.length;i+=1){sort_by_split=sort_bys[i].split("-");if(sort_by_split.length===2){change_sorting_symbol(sort_by_split[1],"sorting-desc");sort_text=$("#"+sort_by_split[1]+"_number")}else{change_sorting_symbol(sort_bys[i],"sorting-asc");sort_text=$("#"+sort_bys[i]+"_number")}sort_text.text(i+1);sort_text.show()}}function set_pagination(){$("#paginate_by_select").val(paginate_by[paginate_by.length-1])}function fix_range_filters(){var filter_name;$("input.range-filter").each(function(){filter_name=$(this).attr("name").split("-filter")[0];if(typeof filter_bys[filter_name]!==typeof undefined){range_filters[filter_name]=filter_bys[filter_name];delete filter_bys[filter_name]}})}function add_sort_by(sort_by){var index=sort_bys.indexOf(sort_by);var sort_text=$("#"+sort_by+"_number");sort_text.hide();if(index===-1){index=sort_bys.indexOf("-"+sort_by)}if(index===-1){sort_bys.push(sort_by);change_sorting_symbol(sort_by,"sorting-asc")}else if(index===sort_bys.length-1){if(sort_bys[index].split("-").length===2){sort_bys.splice(index,1);change_sorting_symbol(sort_by,"sorting-none");sort_text.hide()}else{sort_bys[index]="-"+sort_by;change_sorting_symbol(sort_by,"sorting-desc")}}else{sort_bys.splice(index,1);change_sorting_symbol(sort_by,"sorting-none")}goto_new_url(true,true,true)}function goto_new_url(should_include_searches,should_include_filters,should_include_sorts){var i;var filter;var url_suffix="?";add_spinner();if(paginate_by[paginate_by.length-1]!==default_pagination){url_suffix+="paginate_by="+paginate_by[paginate_by.length-1]+"&"}if(page_number!==1){url_suffix+="page="+page_number+"&"}if(should_include_searches){for(i=0;i<search_bys.length;i+=1){url_suffix+="search_by="+search_bys[i]+"&"}}if(should_include_filters){for(filter in filter_bys){url_suffix+="filter_name="+filter+"&filter_value="+filter_bys[filter]+"&"}for(filter in range_filters){url_suffix+="filter_name="+filter+"&filter_value="+range_filters[filter]+"&"}}if(should_include_sorts){for(i=0;i<sort_bys.length;i+=1){url_suffix+="sort_by="+sort_bys[i]+"&"}}if(url_suffix==="?"){url_suffix=""}else if(url_suffix.charAt(url_suffix.length-1)==="&"){url_suffix=url_suffix.slice(0,-1);}window.location.href=window.location.href.split("?")[0]+url_suffix}function change_sorting_symbol(base_id,new_class){var sort_to_set=$("#"+base_id+"_header").find(".sort-controls");sort_to_set.find("div[class^='sorting-']").hide();if(new_class==="sorting-asc"){sort_to_set.find(".sorting-num").css("margin-top","-60%");sort_to_set.find(".sorting-asc, .sorting-num").show();sort_to_set.find(".sorting-desc").hide()}else if(new_class==="sorting-desc"){sort_to_set.find(".sorting-desc").css("margin-top","20%");sort_to_set.find(".sorting-desc, .sorting-num").show();sort_to_set.find(".sorting-asc").hide()}else{sort_to_set.find(".sorting-asc, .sorting-desc").show();sort_to_set.find(".sorting-num").hide()}}function set_filter_button_states(){var clear_filters_button=$("#clear_filters_button");var apply_filters_button=$("#apply_filters_button");if(Object.keys(original_filter_bys).length===0&&Object.keys(filter_bys).length===0&&Object.keys(range_filters).length===0){clear_filters_button.prop("disabled",true);apply_filters_button.prop("disabled",true)}else{clear_filters_button.prop("disabled",false);apply_filters_button.prop("disabled",false);$("#collapse_one").collapse("show")}}function goto_page(new_page_number){if(!isNaN(new_page_number)){if(Math.floor(+new_page_number)=== +new_page_number&&$.isNumeric(+new_page_number)){page_number=new_page_number;goto_new_url(true,true,true)}}}function clear_search(){goto_new_url(false,true,true)}function clear_filters(){goto_new_url(true,false,true)}function clear_sorts(){goto_new_url(true,true,false)}function clear_all(){window.location.href=window.location.href.split("?")[0]}function search(){var search_text=$("#search_text");if(search_text.val()!==""){search_bys=[search_text.val()]}else{search_bys=[]}goto_new_url(true,true,true)}function apply_filters(){goto_new_url(true,true,true)}function toggle_select_all_objects(){var object_list_checkboxes=$(".object-list-checkbox");if($("#select_all_objects_checkbox").is(":checked")){object_list_checkboxes.each(function(){$(this).prop("checked",true)})}else{object_list_checkboxes.each(function(){$(this).prop("checked",false)})}}function get_new_url_via_checkboxes(base_url){var object_list_checkboxes=$(".object-list-checkbox");var url=base_url+"?";var query_string;var at_least_one_box_is_checked=false;var all_pages_checkbox_is_checked=$("#select_all_pages_checkbox").is(":checked");if(all_pages_checkbox_is_checked){query_string=decodeURIComponent(window.location.href).split("?");if(query_string.length===2){url+=query_string[1]}return url}else{object_list_checkboxes.each(function(){if(at_least_one_box_is_checked){return}if($(this).is(":checked")){at_least_one_box_is_checked=true}})}if(at_least_one_box_is_checked){url+="filter_name=id&filter_value="}else{query_string=decodeURIComponent(window.location.href).split("?");if(query_string.length===2){url+=query_string[1]+"&"}url+="__RETURN_EMPTY__=1";return url}object_list_checkboxes.each(function(){if($(this).is(":checked")===true){url+=$(this).val()+","}});if(url.charAt(url.length-1)===","){url=url.slice(0,-1);}return url}function goto_new_url_via_checkboxes(base_url){window.location.href=get_new_url_via_checkboxes(base_url)}